# AGENTS 指南

本指南聚焦通用的 Python 项目开发规范，避免对具体框架的依赖描述，确保跨框架复用性。

目标
- 提高工作流可重复性
- 降低认知成本
- 促进多人协作的一致性

0) 自动修改策略
- 默认情况下，代理在你明确授权范围内，对仓库文件进行修改、注释添加、代码调整以及脚本更新等操作，不再单独请求额外确认。
- 如涉及潜在敏感信息或重大架构变更，将在提交前进行简要的自检并尽量说明变更原因。

1) 构建/Lint/测试命令
- 说明：以下命令优先 Python 生态，结合虚拟环境及常见依赖管理方案。

- Python 环境与依赖：
  - 如使用 Poetry：poetry install
  - 如使用本地虚拟环境：python -m venv .venv
  - 激活虚拟环境并安装依赖

- 构建与打包
  - 构建：python -m build / poetry build

- 依赖与环境锁定
  - Poetry：poetry lock

- Lint/格式/静态分析/类型检查
  - Black、isort、ruff、mypy 等工具按团队约定使用

- 测试
  - 使用 pytest/其他测试框架，给出统一的测试命令

2) 代码风格指南
- 导入排序、格式化、命名、错误处理、注释等通用实践
- 语言特定分支请在后续章节中独立列出。

3) 维护与迭代
- 新语言/框架加入时，请扩展对应章节，确保向后兼容。

4) 参考与链接
- 相关工具版本及文档的引用。

5) 历史表兼容性规则
- 当前项目默认无需考虑历史表的兼容性。
- 如后续需要引入历史表兼容，请在变更前明确规格和迁移策略，并在相关文档中以单独章节记录。
- 变更风险：可能影响数据持久化、回滚、分析结果等。需要额外测试。
- 启用开关：如需启用历史表兼容，建议通过配置项 HISTORY_TABLE_COMPATIBILITY=true/false 控制，默认 false。原则上仅在明确需求和测试通过时启用。
 - 变更记录：每次启用/禁用历史表兼容性时，记录变更原因和影响范围。

6) 提交策略
- 本地优先：所有生成的代码修改应仅在本地文件中进行，避免自动将内容提交到 git（包括暂存阶段）。
- 变更确认：在进行实际提交前，需获得明确的确认（例如通过对话或任务指令中的“确认提交”步骤）。
- 提交内容规范：提交时写清楚原因（why）以及变更内容（what），摘要1-2 行，详细描述放在正文中。
- 避免敏感信息：提交前检查并排除敏感数据（如 .env、credentials.json、密钥、API token 等）。如必须提交，请先移除或通过环境变量注入后提交。
- 不推送远端：不执行自动推送到远端分支，除非用户明确请求并确认。
- 钩子与错误处理：若 pre-commit、lint、test 等钩子失败，需先修正后再提交。若已推送，原则上不要再对历史进行修改。
- 工作流建议：变更 -> 本地测试/验证 -> 审阅/确认 -> 提交 -> 推送（可选）
- 通过此规则保障仓库历史的稳定性，便于追踪与回滚。
结束。
